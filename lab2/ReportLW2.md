# Отчет по лабораторной работе № 1
## по курсу "Операционные системы"

Студент группы М8О-208Б-23 Федорова Екатерина Васильевна

Работа выполнена 

1. **Тема**: Многопоточность
2. **Цель работы**:
Приобретение практических навыков в:
- Управление потоками в ОС 
- Обеспечение синхронизации между потоками

3. **Задание (вариант №22)**:
Составить программу на языке Си, обрабатывающую данные в многопоточном режиме. При обработки использовать стандартные средства создания потоков операционной системы (Windows/Unix). Ограничение максимального количества потоков, работающих в один момент времени, должно быть задано ключом запуска вашей программы.
Так же необходимо уметь продемонстрировать количество потоков, используемое вашей программой с помощью стандартных средств операционной системы.
В отчете привести исследование зависимости ускорения и эффективности алгоритма от входных данных и количества потоков. Получившиеся результаты необходимо объяснить.

4. **Идея, метод, алгоритм решения задачи**: Программа в файле `main.c` получает ключом к запуску исполняемого файла максимальное количество потоков и количество раундов для перемешивания колоды. Производится проверка на валидность введённый ключей, они передаются функции `Process`, расположенной в файле `monte_carlo_maps.c`. По завершении принимает ответ - подсчитанную вероятность, выводя некоторую информацию о ней и о процессе выполнения. 

Функция `Process` создаёт соответственное количество потоков и разделяет между ними количество раундов для подсчёта "попаданий" (часть метода Монте-Карло реализована функцией `Monte_Carlo_Maps`). Результаты вычислений каждый поток записывает в отведённую ему переменную в памяти, после чего суммируются и находится вероятность.

Вспомогательная функция `Fisher_Yates_algorithm` предназначена для случайного перемешивания колоды по алгоритму Фишера-Йетса.

6. **Протокол**: 
Запуск тестов:
```
moscow@moscow:~/Рабочий стол/OS/OS_2k/lab2/build$ lab2/monte_carlo 1
Usage: lab2/monte_carlo <number_threads> <number_rounds>

moscow@moscow:~/Рабочий стол/OS/OS_2k/lab2/build$ lab2/monte_carlo 0 0
The number of rounds cannot be less than 1.

moscow@moscow:~/Рабочий стол/OS/OS_2k/lab2/build$ lab2/monte_carlo 1 10000000
Total matches: 714285 of 10000000 rounds.
The probability that there are two identical cards on the top: 0.071429
Number of threads: 1
Number of rounds: 10000000
Execution time: 2.534691 seconds

moscow@moscow:~/Рабочий стол/OS/OS_2k/lab2/build$ lab2/monte_carlo 2 10000000
Total matches: 429970 of 10000000 rounds.
The probability that there are two identical cards on the top: 0.042997
Number of threads: 2
Number of rounds: 10000000
Execution time: 1.373434 seconds

moscow@moscow:~/Рабочий стол/OS/OS_2k/lab2/build$ lab2/monte_carlo 5 10000000
Total matches: 504185 of 10000000 rounds.
The probability that there are two identical cards on the top: 0.050418
Number of threads: 5
Number of rounds: 10000000
Execution time: 0.770791 seconds

moscow@moscow:~/Рабочий стол/OS/OS_2k/lab2/build$ lab2/monte_carlo 10 10000000
Total matches: 645299 of 10000000 rounds.
The probability that there are two identical cards on the top: 0.064530
Number of threads: 10
Number of rounds: 10000000
Execution time: 0.490182 seconds

moscow@moscow:~/Рабочий стол/OS/OS_2k/lab2/build$ lab2/monte_carlo 30 10000000
Total matches: 583912 of 10000000 rounds.
The probability that there are two identical cards on the top: 0.058391
Number of threads: 30
Number of rounds: 10000000
Execution time: 0.343166 seconds

moscow@moscow:~/Рабочий стол/OS/OS_2k/lab2/build$ lab2/monte_carlo 100 10000000
Total matches: 593645 of 10000000 rounds.
The probability that there are two identical cards on the top: 0.059365
Number of threads: 100
Number of rounds: 10000000
Execution time: 0.336929 seconds

moscow@moscow:~/Рабочий стол/OS/OS_2k/lab2/build$ lab2/monte_carlo 10000 10000000
Total matches: 603275 of 10000000 rounds.
The probability that there are two identical cards on the top: 0.060327
Number of threads: 10000
Number of rounds: 10000000
Execution time: 0.511637 seconds 
```
7. **Замечания автора** по существу работы: -.
8. **Выводы**: В ходе лабораторной работы я приобрела практические навыки в управлении потоками в ОС и обеспечении синхронизации между потоками. Запускаемые вручную тесты показали, что время выполнения программы обратнопропорционально количеству потоков. Это происходит из-за эффективного распараллеливания процессов и ресурсов, причёт каждый поток не конкурирует с другим и рандом потокобезопасен. Однако при достижении "слишком" большого количества потоков времявыполнения начинает наоборот возрастать. Этому способствует нескольких факторов:
- Трата ресурсов на создание и инициализацию нового потока с помощью `pthread_create`. При большом количестве потоков и маленьком количестве раундов затраты на создание и управление ими превышает выгоду от параллельного выполнения.
- Ожидание завершения всех потоков может занять больше времени, чем их выполнение, если количество потоков велико, а раундов относительно мало.
- С увеличением числа потоков возрастает частота контекстного переключения между потоками, поэтому высока вероятность, что потоки будут проводить время в ожидании на переключения.

Для нахождения оптимальных настроек числа потоков и раундов потребуются многократные тестирования.

 Поставленную задачу читаю выполненной. Мне понравилось.