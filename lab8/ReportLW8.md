# Отчет по лабораторной работе № 8
## по курсу "Операционные системы"

Студент группы М8О-208Б-23 Федорова Екатерина Васильевна

Работа выполнена 

1. **Тема**: Диагностика ПО      
2. **Цель работы**:  
   - Приобретение практических навыков диагностики работы программного обеспечения   
   
3. **Задание**: При выполнении лабораторных работ по курсу ОС необходимо продемонстрировать ключевые системные вызовы, которые в них используются и то, что их использование соответствует варианту ЛР.  
По итогам выполнения всех лабораторных работ отчет по данной ЛР должен содержать краткую сводку по исследованию написанных программ.   
Средства диагностики:   
    Для ОС Windows:   
        ● Windbg   
            - http://windbg.info/doc/1-common-cmds.html   
        ● Sysinternals Suite   
            - Handle.exe   
            - Procmon.exe   
            - Procexp.exe   
    Для ОС *nix:   
        ● strace   

**Описание используемых утилит:**   
Strace — это утилита Linux, отслеживающая системные вызовы, которые представляют собой механизм трансляции, обеспечивающий интерфейс между процессом и операционной системой. Использование данной утилиты позволяет понять, что процесс пытается сделать в данное время. Strace может быть полезен при отладке программ.  
Для удобства работы с протоколом утилиты можно использовать следующие ключи:  
    -o file – Перенаправить протокол утилиты в файл file  
    -e trace=filters – Указать выражения, по которым будут фильтроваться системные вызовы. Например -e trace=write,%process задаёт фильтрацию по системным вызовам write и по группе системных вызовов, связанных с межпроцессорным взаимодействием.   
    -f – Отслеживать системные вызовы в дочерних процессах   
    -y – Заменить в протоколе все файловые дескрипторы на имена соответствующих им файлов (где возможно).   
    -p file – Отслеживать только обращения к файлу file   
    -k – Отображать стек вызовов    
Ltrace – это утилита Linux, отслеживающая системные вызовы, связанные с динамическими библиотеками. Использование данной утилиты очень похоже на использование strace.   

Рассмотрим на примере Лабораторной работы №1.

4. **Листинг диагностики**:
```
moscow@moscow:~/Рабочий стол/OS/OS_2k/build$ strace -f -e trace="%process,read,write,dup2,pipe" -o ../lab8/log_lab1.txt ./lab1/parent
asdfgrh
12345ng
asdptk
Rrraaaaadio, Oh, mein Radio!
```
```
moscow@moscow:~/Рабочий стол/OS/OS_2k/build$ strace -f -e trace="%process,read,write" -o ../lab8/log_lab2.txt ./lab2/monte_carlo 10 1000000
Total matches: 67906 of 1000000 rounds.
The probability that there are two identical cards on the top: 0.067906
Number of threads: 10
Number of rounds: 1000000
Execution time: 0.048193 seconds
```
```
moscow@moscow:~/Рабочий стол/OS/OS_2k/build$ strace -f -e trace="%process,read,write,dup2,mmap" -o ../lab8/log_lab3.txt ./lab3/parent
Eins! Hier kommt die Sonne,
Zwei! Hier kommt die Sonne,
1234...
Wie shön Du bist...
```
```
moscow@moscow:~/Рабочий стол/OS/OS_2k/build/lab4$ ltrace -o ../../lab8/log_lab4.txt ./prog_2
Library 1 is loaded by default.
1 15 3
GCF: 3
2 10
In the 2NS is 1010
0
Library 2 is loaded.
1 15 3
GCF: 3
2 10
In the 3NS is 101 
```
```
moscow@moscow:~/Рабочий стол/OS/OS_2k/build$ strace -o ../lab8/log_lab57.txt ./bin/control_node
> create 5
Ok: 19403
> create 6
> Ok: 19421
> create 3
> Ok: 19445
> tree
5
/--3
\--6
> exec 3
> asdfs
> s
> Ok:3: 1;4
> kill 19421
Ok: Process 19421 killed
> ping 5
> Ok: 1
> ping 3
> Ok: 1
> ping 6
> Ok: 0
> exit
```

5. **Результаты диагностики**: [lab1](log_lab1.txt), [lab2](log_lab2.txt), [lab3](log_lab3.txt), [lab4](log_lab4.txt), [lab57](log_lab57.txt)
6. **Анализ log_lab1.txt (основные моменты)**:
   
```
14063 execve("./lab3/parent", ["./lab3/parent"], 0x7fff0b313088 /* 91 vars */) = 0
```
Запуск родительского процесса с PID 14063. Успешное выполнение execve подтверждается нулевым кодом возврата.

```
14063 mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x78504e1f3000
```
Выделение анонимной памяти размером 8192 байт для внутренних нужд процесса. Память имеет права на чтение и запись.

```
14063 clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x78504e1dea10) = 14481
14063 clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x78504e1dea10) = 14482
```
Создание двух дочерних процессов с PID 14481 и 14482. Флаги указывают на автоматическую очистку идентификатора потока и отправку SIGCHLD при завершении.

```
14481 dup2(3, 1) = 1
14482 dup2(4, 1) = 1
```
Перенаправление стандартного вывода (дескриптор 1) для каждого дочернего процесса на новые дескрипторы (3 и 4 соответственно).

```
14481 execve("./lab3/child", ["child", "/shm_channel1"], 0x7fffb223f828)
14482 execve("./lab3/child", ["child", "/shm_channel2"], 0x7fffb223f828)
```
Замена кода дочерних процессов на программу child с разными параметрами для каналов разделяемой памяти.

```
14063 mmap(NULL, 320, PROT_READ|PROT_WRITE, MAP_SHARED, 5, 0) = 0x78504e22c000
14063 mmap(NULL, 320, PROT_READ|PROT_WRITE, MAP_SHARED, 6, 0) = 0x78504e1f2000
```
Создание двух областей разделяемой памяти по 320 байт каждая для межпроцессного взаимодействия.

```
14063 read(0, "Eins! Hier kommt die Sonne,\n", 1024) = 28
```
Чтение пользовательского ввода родительским процессом. Прочитано 28 байт.

```
14481 write(1, ",ennoS eid tmmok\n", 17) = 17
```
Запись обработанных данных первым дочерним процессом. Строка перевернута, что соответствует заданию.

```
14063 --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
14481 --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
14482 --- SIGINT {si_signo=SIGINT, si_code=SI_KERNEL} ---
```
Получение сигнала SIGINT (Ctrl+C) всеми процессами, что приводит к их корректному завершению.

На примере лабораторной работы №3 было продемонстрировано, как с помощью `strace` можно отследить все ключевые системные вызовы:
•	Создание процессов через `clone()`
•	Организацию разделяемой памяти через `mmap()`
•	Перенаправление ввода/вывода через `dup2()`
•	Базовые операции чтения/записи через `read()` и `write()`

Анализ системных вызовов подтвердил корректность реализации межпроцессного взаимодействия через разделяемую память и правильную обработку сигналов завершения.


7. **Вывод:** В процессе выполнения лабораторной работы были успешно освоены инструменты диагностики `strace` и `ltrace`. Эти утилиты показали себя как эффективные инструменты для отслеживания системных вызовов и анализа работы программ. Хотя изначально вывод утилит может показаться сложным для понимания из-за большого объема информации, использование различных ключей фильтрации (например, `-e trace` для отбора конкретных системных вызовов) позволяет получить именно те данные, которые необходимы для анализа.
